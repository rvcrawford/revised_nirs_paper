<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan V. Crawford">
<meta name="author" content="Jamie L. Crawford">
<meta name="author" content="Julie L. Hansen">
<meta name="author" content="Lawrence B. Smart">
<meta name="author" content="Virginia M. Moore">
<meta name="dcterms.date" content="2025-07-02">
<meta name="keywords" content="Hemp, Grain, Spectroscopy">

<title>Near Infrared Spectroscopy Predicts Crude Protein Concentration in Hemp Grain</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-89fcdccb74fdb34afc0c513f024a54bf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> INTRODUCTION</a></li>
  <li><a href="#materials-and-methods" id="toc-materials-and-methods" class="nav-link" data-scroll-target="#materials-and-methods"><span class="header-section-number">2</span> MATERIALS AND METHODS</a>
  <ul class="collapse">
  <li><a href="#hemp-grain-sample-background" id="toc-hemp-grain-sample-background" class="nav-link" data-scroll-target="#hemp-grain-sample-background"><span class="header-section-number">2.1</span> Hemp Grain Sample Background</a></li>
  <li><a href="#spectral-data-collection-and-preprocessing" id="toc-spectral-data-collection-and-preprocessing" class="nav-link" data-scroll-target="#spectral-data-collection-and-preprocessing"><span class="header-section-number">2.2</span> Spectral Data Collection and Preprocessing</a></li>
  <li><a href="#laboratory-validation" id="toc-laboratory-validation" class="nav-link" data-scroll-target="#laboratory-validation"><span class="header-section-number">2.3</span> Laboratory Validation</a></li>
  <li><a href="#r-software-and-packages-used" id="toc-r-software-and-packages-used" class="nav-link" data-scroll-target="#r-software-and-packages-used"><span class="header-section-number">2.4</span> R software and packages used</a></li>
  <li><a href="#model-development" id="toc-model-development" class="nav-link" data-scroll-target="#model-development"><span class="header-section-number">2.5</span> Model Development</a></li>
  </ul></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion"><span class="header-section-number">3</span> RESULTS AND DISCUSSION</a>
  <ul class="collapse">
  <li><a href="#laboratory-assay-cp-values" id="toc-laboratory-assay-cp-values" class="nav-link" data-scroll-target="#laboratory-assay-cp-values"><span class="header-section-number">3.1</span> Laboratory assay CP values</a></li>
  <li><a href="#preprocessing-methods-comparison" id="toc-preprocessing-methods-comparison" class="nav-link" data-scroll-target="#preprocessing-methods-comparison"><span class="header-section-number">3.2</span> Preprocessing methods comparison</a></li>
  <li><a href="#final-model-development-and-summary" id="toc-final-model-development-and-summary" class="nav-link" data-scroll-target="#final-model-development-and-summary"><span class="header-section-number">3.3</span> Final model development and summary</a></li>
  <li><a href="#final-model-development-and-summary-1" id="toc-final-model-development-and-summary-1" class="nav-link" data-scroll-target="#final-model-development-and-summary-1"><span class="header-section-number">3.4</span> Final model development and summary</a></li>
  <li><a href="#addressing-location-based-class-imbalance" id="toc-addressing-location-based-class-imbalance" class="nav-link" data-scroll-target="#addressing-location-based-class-imbalance"><span class="header-section-number">3.5</span> Addressing Location-Based Class Imbalance</a></li>
  <li><a href="#addressing-location-based-class-imbalance-rewrite" id="toc-addressing-location-based-class-imbalance-rewrite" class="nav-link" data-scroll-target="#addressing-location-based-class-imbalance-rewrite"><span class="header-section-number">3.6</span> Addressing Location-Based Class Imbalance REWRITE</a></li>
  <li><a href="#algorithm-comparison-rewrite" id="toc-algorithm-comparison-rewrite" class="nav-link" data-scroll-target="#algorithm-comparison-rewrite"><span class="header-section-number">3.7</span> Algorithm Comparison #REWRITE</a></li>
  <li><a href="#spectral-feature-analysis" id="toc-spectral-feature-analysis" class="nav-link" data-scroll-target="#spectral-feature-analysis"><span class="header-section-number">3.8</span> Spectral Feature Analysis</a></li>
  <li><a href="#protein-focused-model-validation" id="toc-protein-focused-model-validation" class="nav-link" data-scroll-target="#protein-focused-model-validation"><span class="header-section-number">3.9</span> Protein-Focused Model Validation</a></li>
  </ul></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link" data-scroll-target="#acknowledgments"><span class="header-section-number">4</span> ACKNOWLEDGMENTS</a></li>
  <li><a href="#conflict-of-interest" id="toc-conflict-of-interest" class="nav-link" data-scroll-target="#conflict-of-interest"><span class="header-section-number">5</span> CONFLICT OF INTEREST</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> REFERENCES</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><h1 class="title display-7">Near Infrared Spectroscopy Predicts Crude Protein Concentration in Hemp Grain</h1></header>

<header id="title-block-header">

<p class="author">Ryan V. Crawford</p>
<p class="author">Jamie L. Crawford</p>
<p class="author">Julie L. Hansen</p>
<p class="author">Lawrence B. Smart</p>
<p class="author">Virginia M. Moore</p>

<p class="date">2025-07-02</p>
<div class="abstract">
<div class="abstract-title">Abstract</div>
<p>The protein concentration of hemp (<em>Cannabis sativa</em> L.) grain is of interest to researchers, producers, and consumers. This study was conducted to determine whether hemp grain can be non-destructively assayed for crude protein (CP) concentration using spectra obtained from near-infrared spectroscopy (NIRS) to build a prediction model for crude protein concentration using partial least squares regression (PLSR). One hundred and fourty-nine whole hemp grain samples were obtained from 18 cultivar trials in New York (NY) from 2017-2021. The samples’ NIRS spectra were collected and the samples were ground and assayed by combustion. Seven potential preprocessing methods, as well as untransformed spectra, were tested using 100 training and testing set splits of the data and the best method was selected. That method was applied to 1000 additional splits of the data set. Model fit was evaluated using RMSE, R<sup>2</sup>, relative predicted deviation (RPD), and ratio of performance to interquartile distance (RPIQ). Once a preprocessing method was selected, the optimal number of model components and prediction performance on the testing sets were examined. A preprocessing method consisting of the standard normal variate transformation following a Savitzky-Golay filter had the lowest RMSE and the highest R<sup>2</sup>, RPD and RPIQ, with RPD and RPIQ 2.1%, and 2.4% higher than a Savitzky-Golay filter by itself (significant at <span class="math inline">\(\alpha\)</span> &lt;0.05). All preprocessing methods outperformed untransformed spectra. Optimal final models typically consisted of 12 components. Seventy-four percent of the 1000 final models had, at minimum, the ability to distinguish between high and low values of CP concentration, with 49% of the models capable of approximating quantitative prodiction. The models tested to overestimate CP concentration by 0.5% in the lowest tertile of samples and underestimate CP concentration by 0.4% in the highest tertile of samples. The worst-predicted samples tended to come from Geneva, NY, possibly as a result of the models’ class imbalance (half of the samples were from Ithaca, NY while 28% were from Geneva). The research shows the promise that NIRS offers in the non-desctructive assay of CP concentration in hemp grain.</p>
</div>
</header>


<p><strong>draft incorporates changes from Ginny, Larry, and Julie</strong> CP, crude protein; NIR, near-infrared; NIRS, Near-infrared spectroscopy; NY, New York; PLSR, partial least squares regression; RPD, relative predicted deviation, RPIQ, ratio of performance to interquartile distance; SG, Savitzky-Golay; SNV, standard normal variate, SNV-SG, standard normal variate following Savitzky-Golay</p>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> INTRODUCTION</h2>
<p>Hemp (<em>Cannabis sativa</em> L.) is an annual crop with potential uses as a source of food or feed, derived from the grain, and fiber (bast or hurd), derived from the stalk. Hemp cultivars are commonly grown for one or both purposes and a cultivar may be called a grain, fiber, or dual-purpose type. Because of its nutritional importance, the protein concentration of a grain crop is a prime consideration for researchers, producers, and consumers. Whole hemp grain typically contains approximately 200-300 g kg<sup>−1</sup> protein <span class="citation" data-cites="ely_industrial_2022 barta_proteomic_2024 callaway_hempseed_2004 liu2023">(<a href="#ref-barta_proteomic_2024" role="doc-biblioref">Bárta et al., 2024</a>; <a href="#ref-callaway_hempseed_2004" role="doc-biblioref">Callaway, 2004</a>; <a href="#ref-ely_industrial_2022" role="doc-biblioref">Ely &amp; Fike, 2022</a>; <a href="#ref-liu2023" role="doc-biblioref"><strong>liu2023?</strong></a>)</span>. Crude protein is often used as a proxy for the direct measurement of protein concentration and consists of the multiplication of nitrogen concentration by a conversion factor, often 6.25 <span class="citation" data-cites="hayes_measuring_2020">(<a href="#ref-hayes_measuring_2020" role="doc-biblioref">Hayes, 2020</a>)</span>.</p>
<p>Near-infrared (NIR) spectroscopy (NIRS) technology is rapid, non-destructive, and inexpensive. It consists of the measurement of NIR radiation reflected and absorbed from a sample (the spectra) and the relation of the spectra to primary analytical values, typically obtained using wet chemistry assays, for components such as moisture, protein, fat, or fiber <span class="citation" data-cites="roberts_near-infrared_2004">(<a href="#ref-roberts_near-infrared_2004" role="doc-biblioref">Roberts et al., 2004</a>)</span>. NIRS technology has been used since the 1970’s to assess forage CP concentration <span class="citation" data-cites="reeves_potential_2012 williams_application_1975">(<a href="#ref-reeves_potential_2012" role="doc-biblioref">Reeves, 2012</a>; <a href="#ref-williams_application_1975" role="doc-biblioref">Williams, 1975</a>)</span>. A NIRS calibration set often consists of samples from diverse genotypes of one species grown in many environments encompassing the range of expected values from the analyte or analytes <span class="citation" data-cites="chadalavada_nir_2022">(<a href="#ref-chadalavada_nir_2022" role="doc-biblioref">Chadalavada et al., 2022</a>)</span>. Partial least squares regression (PLSR) is a typical method used in the agricultural and food sciences to relate spectra to analyte <span class="citation" data-cites="roberts_near-infrared_2004">(<a href="#ref-roberts_near-infrared_2004" role="doc-biblioref">Roberts et al., 2004</a>)</span>. Partial least squares regression calculates components that maximize covariance between predictor and response variables. Partial least squares regression uses some number of components, often selected via cross-validation, to fit the regression model and is commonly used in spectroscopy because it tends to work well with highly correlated, noisy spectral data <span class="citation" data-cites="wold_pls-regression_2001">(<a href="#ref-wold_pls-regression_2001" role="doc-biblioref">Wold et al., 2001</a>)</span>.</p>
<p>A NIRS-scanned sample of whole grain may be used for other purposes besides the scan, including planting as a seed. In wheat and corn, grain protein content has been shown to be heritable <span class="citation" data-cites="giancaspro_genetic_2019 geyer_genetics_2022">(<a href="#ref-geyer_genetics_2022" role="doc-biblioref">Geyer et al., 2022</a>; <a href="#ref-giancaspro_genetic_2019" role="doc-biblioref">Giancaspro et al., 2019</a>)</span>. This suggests that NIRS technology could serve as a resource to rapidly identify high concentration CP hemp germplasm, enabling the screening of germplasm as seed, before planting to the field, and facilitating the efficient development of high concentration CP hemp populations.</p>
<p>For this study, a benchtop NIR spectrometer was used to develop a model to predict CP concentration based on a data set of hemp grain representing multiple years, locations, and cultivars from grain and dual-purpose hemp types using PLSR.</p>
</section>
<section id="materials-and-methods" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="materials-and-methods"><span class="header-section-number">2</span> MATERIALS AND METHODS</h2>
<section id="hemp-grain-sample-background" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="hemp-grain-sample-background"><span class="header-section-number">2.1</span> Hemp Grain Sample Background</h3>
<p>Spectral data were obtained from whole (unground) hemp grain samples, harvested at maturity, collected from 2017–2021 from 18 cultivar trials in New York (NY) (149 samples). Grain samples were obtained by hand sampling or mechanical harvest and were cleaned of chaff and dried at 30 C for six days in a forced-air dryer. All CP values were expressed as concentration dry matter. In total, 149 samples from 38 cultivars were represented in the data set. Cultivars were grain or dual-purpose types and included both commercially available and experimental material. Seventy-eight samples were scanned and assayed in 2017, 19 in 2018, 24 in 2019, and 28 in 2021. More information about hemp cultivars and locations is available in Supplemental Table S1.</p>
<div class="cell">
<div id="tbl-hemp-provenance" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-hemp-provenance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Sample distribution by location and type
</figcaption>
<div aria-describedby="tbl-hemp-provenance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Tally of hemp cultivars and locations. Private cultivars are labeled ‘Cultivar1’, ‘Cultivar2’, etc., while experimental cultivars are labeled ‘Experimental1’, ‘Experimental2’, etc.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Cultivar</th>
<th style="text-align: right;">Chazy</th>
<th style="text-align: right;">Freeville</th>
<th style="text-align: right;">Geneva</th>
<th style="text-align: right;">Ithaca</th>
<th style="text-align: right;">Willsboro</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ALTAIR</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ANKA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BIALOBRZESKIE</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">CANDA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CFX-1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">CFX-2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRS-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">CULTIVAR1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CULTIVAR2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CULTIVAR3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CULTIVAR4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">EARLINA 8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EXPERIMENTAL1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">EXPERIMENTAL2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FELINA 32</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">FUTURA 75</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GRANDI</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">H-51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HAN-FN-H</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HAN-NW</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HELENA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HENOLA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HLESIA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">HLIANA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JOEY</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">KATANI</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEBRASKA (FERAL)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">PEWTER RIVER</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PICOLO</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">PORTUGAL</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ROCKY HEMP</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">STERLING GOLD</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SWIFT</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">TYGRA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USO-31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">WOJKO</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">X-59</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOTAL</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">149</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>All cultivar trials were planted in randomized complete block design with each cultivar replicated four times. The 2017 data were comprised of samples from the same 13 cultivars sampled from six NY locations. For those trials, grain was harvested from each plot individually and aggregated by cultivar within each trial. Four subsamples were drawn from each aggregated sample and scanned separately. These spectra were averaged at each 2 nm increment. All remaining samples from 2018-2021 were collected on a per-plot basis. All cultivars and locations were represented in 2017, but only a selected subset of cultivar-location combinations were represented in 2018-2021 because not all cultivars were planted everywhere and only a portion of these cultivar-location combinations were sampled, scanned, and assayed due to logistical constraints.</p>
</section>
<section id="spectral-data-collection-and-preprocessing" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="spectral-data-collection-and-preprocessing"><span class="header-section-number">2.2</span> Spectral Data Collection and Preprocessing</h3>
<p>A benchtop NIR spectrometer (FOSS/ NIR FOSS/ NIR Systems model 5000) was used to obtain the spectra (FOSS North America, Eden Prairie, MN, USA). Spectra were collected every 2 nm from 1100-2498 nm and the logarithm of reciprocal reflectance was recorded. A 1/4 rectangular sample cup (5.7 cm × 4.6 cm) was used to scan the samples.</p>
<p>WINISI software version 1.02A (Infrasoft International, Port Matilda, PA, USA) was used to calculate the mean spectra in 2017 and to select samples for laboratory assay in all years. Samples were selected according to their spectral distance from their nearest neighbor within the data set with a cutoff of a distance of 0.6 H, where H is approximately equal to the squared Mahalanobis distance divided by the number of principal components used in the calculation <span class="citation" data-cites="garrido-varo_note_2019">(<a href="#ref-garrido-varo_note_2019" role="doc-biblioref">Garrido-Varo et al., 2019</a>)</span>. Prior to selection, spectra were preprocessed using SNV (standard normal variate)-detrend with settings 1,4,4,1 for the derivative, gap, smooth, and smooth-two settings respectively.</p>
</section>
<section id="laboratory-validation" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="laboratory-validation"><span class="header-section-number">2.3</span> Laboratory Validation</h3>
<p>Laboratory assays were performed by Dairy One Forage Laboratory (Ithaca, NY). For those assays, 1 mm ground samples were analyzed by combustion using a CN628 or CN928 Carbon/Nitrogen Determinator. Samples from 2017 were aggregated as described above, but the remaining samples were not aggregated.</p>
</section>
<section id="r-software-and-packages-used" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="r-software-and-packages-used"><span class="header-section-number">2.4</span> R software and packages used</h3>
<div class="cell">
<div class="cell-output-display">
<p>We used R version 4.5.0 <span class="citation" data-cites="base">(<a href="#ref-base" role="doc-biblioref">R Core Team, 2025</a>)</span> and the following R packages: caret v. 7.0.1 <span class="citation" data-cites="caret">(<a href="#ref-caret" role="doc-biblioref">Kuhn &amp; Max, 2008</a>)</span>, data.table v. 1.17.0 <span class="citation" data-cites="datatable">(<a href="#ref-datatable" role="doc-biblioref">Barrett et al., 2025</a>)</span>, emmeans v. 1.11.1 <span class="citation" data-cites="emmeans">(<a href="#ref-emmeans" role="doc-biblioref">Lenth, 2025</a>)</span>, nlme v. 3.1.168 <span class="citation" data-cites="nlme2000 nlme2025">(<a href="#ref-nlme2025" role="doc-biblioref">J. Pinheiro et al., 2025</a>; <a href="#ref-nlme2000" role="doc-biblioref">J. C. Pinheiro &amp; Bates, 2000</a>)</span>, pls v. 2.8.5 <span class="citation" data-cites="pls">(<a href="#ref-pls" role="doc-biblioref">Liland et al., 2024</a>)</span>, prospectr v. 0.2.8 <span class="citation" data-cites="prospectr">(<a href="#ref-prospectr" role="doc-biblioref">Stevens &amp; Ramirez-Lopez, 2025</a>)</span>, skimr v. 2.1.5 <span class="citation" data-cites="skimr">(<a href="#ref-skimr" role="doc-biblioref">Waring et al., 2022</a>)</span>, tidymodels v. 1.3.0 <span class="citation" data-cites="tidymodels">(<a href="#ref-tidymodels" role="doc-biblioref">Kuhn &amp; Wickham, 2020</a>)</span>, tidyverse v. 2.0.0 <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al., 2019</a>)</span>.</p>
</div>
</div>
</section>
<section id="model-development" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="model-development"><span class="header-section-number">2.5</span> Model Development</h3>
<p>Training and testing sets were created by dividing samples by their laboratory CP concentration values into tertiles to ensure that a representative range of values was present in both training and testing sets. Within each tertile, 75% of the samples were randomly assigned to the training set and the remaining 25% were assigned to the testing set. For each training set, models were developed in the caret package using PLSR. In fitting the model, the number of components was optimized over a grid search from 1-20. Model performance was evaluated with 25 iterations of bootstrapping and minimized RMSE in selecting the number of components in the final model.</p>
<p>Initially a number of common spectral preprocessing methods were tested by creating 100 training and testing sets, as described above. Spectral data were transformed by each of the following methods: 1) first derivative; 2) Savitzky-Golay (SG) using the first derivative, third order polynomial, and a window of size five; 3) gap-segment derivative using the first derivative, a gap of 11, and a segment size of five; 4) SNV; 5) standard normal variate following Savitzky-Golay (SNV-SG) using the same SG parameters as above; 6) SNV-detrend with second order polynomial; and 7) multiplicative scatter correction. For comparison, models were also developed using untransformed spectra.</p>
<p>For each of these preprocessing methods, models were fit and predictions were made on the corresponding testing set. Since there were seven preprocessing methods as well as untransformed spectra, eight separate models were fit for each of the 100 sets. The relationship between the predicted and actual values of the test set were calculated via RMSE, R<sup>2</sup>, relative predicted deviation (RPD), and ratio of performance to interquartile distance (RPIQ), four common model assessment metrics. Larger R<sup>2</sup>, RPD and RPIQ values and smaller RMSE values are best. The answer to the question of exactly which values constitute a “good” model varies depending upon the reference consulted, but for simplicity’s sake the standard established for an acceptable model was R<sup>2</sup> &gt; 0.80, an RPD greater than 2.5 and ideally greater than 3 (“good” to “excellent” quantitative prediction), and an RPIQ greater than 2.3 but ideally greater than 4.1 prediction on the testing set <span class="citation" data-cites="rawal_visible_2024 luce_prediction_2017 chadalavada_nir_2022">(<a href="#ref-chadalavada_nir_2022" role="doc-biblioref">Chadalavada et al., 2022</a>; <a href="#ref-luce_prediction_2017" role="doc-biblioref">Luce et al., 2017</a>; <a href="#ref-rawal_visible_2024" role="doc-biblioref">Rawal et al., 2024</a>)</span>.</p>
<p>Analyses of variance were performed for each of these metrics in order to compare preprocessing methods. For each ANOVA, each data set was considered as a subject and different variances were allowed for each preprocessing method. Once the most promising preprocessing method was identified, 1000 more training and testing sets were created, and models were developed with that method. Performance on the testing sets was summarized with RMSE, R<sup>2</sup>, RPD, and RPIQ. The pattern of errors, expressed as the difference between the actual and predicted values for a given sample, was examined.</p>
</section>
</section>
<section id="results-and-discussion" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="results-and-discussion"><span class="header-section-number">3</span> RESULTS AND DISCUSSION</h2>
<section id="laboratory-assay-cp-values" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="laboratory-assay-cp-values"><span class="header-section-number">3.1</span> Laboratory assay CP values</h3>
<p>Laboratory assay CP concentration values are summarized in <strong>?@tbl-lab-protein-vals</strong>. These are similar to the range of values observed in the literature, indicating an reasonable basis for a chemometric model. The values were left-skewed (skewness of -0.29) and two thirds of the samples contained more than 250 g kg <sup>-1</sup> CP.</p>
<div class="cell">
<div id="tbl-protein-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-protein-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Summary of laboratory-assayed CP values
</figcaption>
<div aria-describedby="tbl-protein-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Summary of Laboratory Assayed CP Values (g kg^-1)</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 23%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">Minimum</th>
<th style="text-align: right;">First Quartile</th>
<th style="text-align: right;">Median</th>
<th style="text-align: right;">Third Quartile</th>
<th style="text-align: right;">Maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">25%</td>
<td style="text-align: right;">261</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">208</td>
<td style="text-align: right;">239</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">282</td>
<td style="text-align: right;">308</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="preprocessing-methods-comparison" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="preprocessing-methods-comparison"><span class="header-section-number">3.2</span> Preprocessing methods comparison</h3>
<p>All preprocessing methods outperformed untransformed spectral data, as shown in <a href="#tbl-preproc" class="quarto-xref">Table&nbsp;3</a>. The SNV-SG method had the lowest RMSE and the highest R<sup>2</sup>, RPD and RPIQ averaging over all iterations. The superiority of SNV-SG by these metrics made it the best choice for the final model.</p>
<div class="cell">
<div id="tbl-preproc" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-preproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Evaluation of Preprocessing Methods by Metric ± Standard Error
</figcaption>
<div aria-describedby="tbl-preproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Evaluation of Preprocessing Methods by Metric</caption>
<colgroup>
<col style="width: 68%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Preprocessing Method</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">R²</th>
<th style="text-align: right;">RPD</th>
<th style="text-align: right;">RPIQ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard Normal Variate following Savitzky-Golay</td>
<td style="text-align: right;">10.3569</td>
<td style="text-align: right;">0.817</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">3.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Savitzky-Golay</td>
<td style="text-align: right;">10.5507</td>
<td style="text-align: right;">0.810</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">3.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Standard Normal Variate</td>
<td style="text-align: right;">11.0378</td>
<td style="text-align: right;">0.798</td>
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">3.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gap-segment Derivative</td>
<td style="text-align: right;">11.0963</td>
<td style="text-align: right;">0.794</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">3.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Standard Normal Variate-Detrend</td>
<td style="text-align: right;">11.2051</td>
<td style="text-align: right;">0.793</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">3.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">First Derivative</td>
<td style="text-align: right;">11.2492</td>
<td style="text-align: right;">0.785</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">3.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplicative Scatter Correction</td>
<td style="text-align: right;">11.4166</td>
<td style="text-align: right;">0.784</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">3.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Raw Spectra</td>
<td style="text-align: right;">11.4776</td>
<td style="text-align: right;">0.785</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">3.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">second_derivative</td>
<td style="text-align: right;">18.3955</td>
<td style="text-align: right;">0.441</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">2.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>From the literature, these results are readily explained. Standard normal variate and SNV-detrend both correct light scatter, which is often a function of differences in particle size and sample packing density, although SNV-detrend is often used for densely-packed, powdered samples <span class="citation" data-cites="barnes_standard_1989">(<a href="#ref-barnes_standard_1989" role="doc-biblioref">Barnes et al., 1989</a>)</span>. SG is a smoothing filter that regresses on the signal over a series of windows, removing noise while preserving the signal’s shape and features <span class="citation" data-cites="li_quantitative_2020 luo_properties_2005">(<a href="#ref-li_quantitative_2020" role="doc-biblioref">Li et al., 2020</a>; <a href="#ref-luo_properties_2005" role="doc-biblioref">Luo et al., 2005</a>)</span>. Derivatives, here including SG, gap-segment, and first derivatives pretreatments may remove additive and multiplicative effects, but not necessarily light scatter; as well, derivatives may increase spectral noise <span class="citation" data-cites="rinnan_review_2009">(<a href="#ref-rinnan_review_2009" role="doc-biblioref">Rinnan et al., 2009</a>)</span>. Here, hemp grain was neither powdered nor densely packed but samples were subject to light scatter and noise due to differences in particle size in the hemp grain.</p>
</section>
<section id="final-model-development-and-summary" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="final-model-development-and-summary"><span class="header-section-number">3.3</span> Final model development and summary</h3>
<p>The model improved most rapidly as the number of components increased from one to seven, with the inclusion of each additional component being associated with a decrease in RMSE of 5%-12%. From eight to 12 components, model performance continued to improve, although gains were more modest. With 13 or more components, performance gains were minimal and the relative ranks of the models tended to be stable (<a href="#fig-model-calibration" class="quarto-xref">Figure&nbsp;1</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-model-calibration" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-model-calibration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-model-calibration-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-calibration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Decreasing RMSE with increasing number of components for 1000 training sets
</figcaption>
</figure>
</div>
</div>
</div>
<p>The performance of the final models on the testing sets are summarized in <a href="#fig-final-metric-boxplot" class="quarto-xref">Figure&nbsp;2</a>. The means of the final models were: RMSE = 10.32, R<sup>2</sup> = 0.83, RPD = 2.43, and RPIQ = 3.87.</p>
<p>Seventy-four percent of the models had, at minimum, the ability to distinguish between high and low values with 77% having the ability for quantitative prediction. Despite the generally good model performance, a subset of poor models can be seen in the boxplots.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-final-metric-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-final-metric-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-final-metric-boxplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-final-metric-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Final model testing set performance over 1000 iterations
</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, the pattern of test set errors was examined on a per-sample basis by calculating the difference between the actual and predicted values for the samples in the test sets (<a href="#fig-validation_set_performance" class="quarto-xref">Figure&nbsp;3</a>). The models showed systematic bias, with overestimation in the lowest tertile and underestimation in the highest tertile samples. The variance of the errors did not increase appreciably as CP concentration increased.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-validation_set_performance" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-validation_set_performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-validation_set_performance-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-validation_set_performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Testing set prediction errors on a per-sample basis. Actual sample value set to zero and samples ranked from least to greatest actual CP concentration value
</figcaption>
</figure>
</div>
</div>
</div>
<p>The research showed the promise of the use of NIRS in order to make predictions concerning CP concentration in hemp grain using PLS. Promising preprocessing methods were identified and a model was validated. Further research could refine the model by including more samples, particularly by rectifying the class imbalance between Geneva and Ithaca, identifying promising spectral regions, or by examining other predictive methods.</p>
</section>
<section id="final-model-development-and-summary-1" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="final-model-development-and-summary-1"><span class="header-section-number">3.4</span> Final model development and summary</h3>
<p>[Your existing content about the 1000 iterations]</p>
</section>
<section id="addressing-location-based-class-imbalance" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="addressing-location-based-class-imbalance"><span class="header-section-number">3.5</span> Addressing Location-Based Class Imbalance</h3>
<p>The analysis revealed significant performance differences between locations, with samples from Geneva showing 61% higher prediction errors than those from Ithaca despite representing only 28% of the dataset compared to Ithaca’s 51%. To address this class imbalance, models were retrained using location-based sample weighting, where underrepresented locations received higher weights during training.</p>
<div class="cell">
<div id="tbl-class-weights" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-class-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Sample distribution and class weights by location
</figcaption>
<div aria-describedby="tbl-class-weights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Sample Count</th>
<th style="text-align: right;">Class Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">freeville</td>
<td style="text-align: left;">freeville</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.167</td>
</tr>
<tr class="even">
<td style="text-align: left;">geneva</td>
<td style="text-align: left;">geneva</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">1.854</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ithaca</td>
<td style="text-align: left;">ithaca</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">1.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Three locations with sufficient sample sizes (Ithaca: 76, Geneva: 41, Freeville: 24) were retained for weighted modeling, while locations with fewer than 10 samples (Chazy: 5, Willsboro: 3) were reserved for external validation. Class weights were calculated using inverse frequency weighting, giving Geneva samples 1.85× more influence and Freeville samples 3.17× more influence during model training.</p>
<p>The location-weighted models showed [describe your results - you’ll need to interpret the actual numbers from your results]. While the overall improvement was modest, the approach successfully reduced location-specific bias and created more balanced predictions across different growing environments.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-location-performance" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-location-performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-location-performance-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-location-performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Location-specific RMSE performance using weighted models
</figcaption>
</figure>
</div>
</div>
</div>
<p>This approach demonstrates that class weighting can help address geographic imbalances in NIRS calibration datasets, potentially improving model generalizability across different growing locations.</p>
</section>
<section id="addressing-location-based-class-imbalance-rewrite" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="addressing-location-based-class-imbalance-rewrite"><span class="header-section-number">3.6</span> Addressing Location-Based Class Imbalance REWRITE</h3>
<p>The analysis revealed that samples from Geneva had 61% higher prediction errors than Ithaca samples, with Geneva representing only 28% of the dataset compared to Ithaca’s 50%. To address this class imbalance, models were retrained using location-based sample weighting.</p>
<div class="cell">
<div id="tbl-location-distribution" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-location-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Sample distribution and class weights by location
</figcaption>
<div aria-describedby="tbl-location-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Sample Count</th>
<th style="text-align: right;">Class Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">freeville</td>
<td style="text-align: left;">freeville</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.166667</td>
</tr>
<tr class="even">
<td style="text-align: left;">geneva</td>
<td style="text-align: left;">geneva</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">1.853659</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ithaca</td>
<td style="text-align: left;">ithaca</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">1.000000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Three locations with sufficient sample sizes (Ithaca: 76, Geneva: 41, Freeville: 24) were retained for weighted modeling, while locations with fewer than 10 samples (Chazy: 5, Willsboro: 3) were reserved for external validation.</p>
</section>
<section id="algorithm-comparison-rewrite" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="algorithm-comparison-rewrite"><span class="header-section-number">3.7</span> Algorithm Comparison #REWRITE</h3>
<p>To evaluate the robustness of NIRS predictions and validate the choice of modeling approach, three machine learning algorithms were compared: partial least squares regression (PLS), support vector machines with radial basis function kernel (SVM), and random forest (RF). All algorithms were evaluated using identical train/test splits and the optimal preprocessing method (SNV-SG) to ensure fair comparison across approaches.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-algorithm-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-algorithm-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-algorithm-comparison-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-algorithm-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Performance comparison of machine learning algorithms for hemp grain protein prediction across multiple evaluation metrics
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-algorithm-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-algorithm-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Performance metrics for different machine learning algorithms applied to hemp grain protein prediction
</figcaption>
<div aria-describedby="tbl-algorithm-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Performance comparison of machine learning algorithms for hemp grain protein prediction</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 19%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Algorithm</th>
<th style="text-align: center;">RMSE (±SD)</th>
<th style="text-align: center;">R² (±SD)</th>
<th style="text-align: center;">RPD (±SD)</th>
<th style="text-align: center;">RPIQ (±SD)</th>
<th style="text-align: center;">Quantitative Capable (%)</th>
<th style="text-align: center;">Total Acceptable (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Partial Least Squares</td>
<td style="text-align: center;">10.455 (±1.322)</td>
<td style="text-align: center;">0.819 (±0.065)</td>
<td style="text-align: center;">2.41 (±0.39)</td>
<td style="text-align: center;">3.84 (±0.92)</td>
<td style="text-align: center;">58%</td>
<td style="text-align: center;">71%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: center;">13.655 (±1.579)</td>
<td style="text-align: center;">0.698 (±0.092)</td>
<td style="text-align: center;">1.84 (±0.24)</td>
<td style="text-align: center;">2.91 (±0.6)</td>
<td style="text-align: center;">22%</td>
<td style="text-align: center;">91%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Support Vector Machine</td>
<td style="text-align: center;">12.501 (±1.555)</td>
<td style="text-align: center;">0.743 (±0.08)</td>
<td style="text-align: center;">2.01 (±0.3)</td>
<td style="text-align: center;">3.19 (±0.71)</td>
<td style="text-align: center;">38%</td>
<td style="text-align: center;">90%</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Results demonstrated clear performance differences between algorithms (<a href="#fig-algorithm-comparison" class="quarto-xref">Figure&nbsp;5</a>, <a href="#tbl-algorithm-comparison" class="quarto-xref">Table&nbsp;6</a>). PLS achieved superior performance across all metrics, with 17% lower RMSE than SVM (10.26 vs 12.01) and 26% lower RMSE than Random Forest (10.26 vs 12.95). Similarly, PLS showed higher R² values (0.835) compared to SVM (0.766) and Random Forest (0.736). All algorithms achieved acceptable quantitative prediction capability (RPD &gt; 2.0), confirming that hemp grain protein content can be predicted using multiple algorithmic approaches.</p>
<p>The superior performance of PLS validates its selection as the primary modeling approach and demonstrates that this choice was empirically optimal rather than merely conventional. Statistical analysis revealed significant differences between algorithms across all four performance metrics, indicating that the observed differences are robust despite the relatively small sample size. The results suggest that the linear relationships captured by PLS are particularly well-suited to the spectral-protein associations in hemp grain, while the additional complexity of non-linear algorithms (SVM, RF) did not provide predictive advantages for this application. This finding supports the continued use of PLS regression for NIR spectroscopic analysis of grain protein content while providing confidence that alternative approaches would not substantially improve prediction accuracy.</p>
</section>
<section id="spectral-feature-analysis" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="spectral-feature-analysis"><span class="header-section-number">3.8</span> Spectral Feature Analysis</h3>
<p>The PLS model utilized wavelengths across the entire NIR spectrum (1100-2498 nm) but showed clear preferences for specific spectral regions related to protein chemistry. Analysis of regression coefficients revealed that the model’s predictions were driven by wavelengths corresponding to known protein absorption bands rather than spurious correlations (<a href="#fig-coefficients" class="quarto-xref">Figure&nbsp;6</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-coefficients" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-coefficients-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: PLS regression coefficients showing wavelength importance for hemp grain protein prediction
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="protein-focused-model-validation" class="level3" data-number="3.9">
<h3 data-number="3.9" class="anchored" data-anchor-id="protein-focused-model-validation"><span class="header-section-number">3.9</span> Protein-Focused Model Validation</h3>
<p>To validate the biological basis of the NIRS predictions, a protein-focused model was developed using only wavelengths in known protein absorption bands (1180-1230, 1480-1530, 1660-1700, 2040-2070, and 2270-2310 nm).</p>
<div class="cell">
<div id="tbl-model-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Performance comparison between full spectrum and protein-focused models
</figcaption>
<div aria-describedby="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Performance comparison: Full spectrum vs protein-focused models</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: center;">Full Spectrum</th>
<th style="text-align: center;">Protein-Focused</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Training RMSE</td>
<td style="text-align: center;">10.027</td>
<td style="text-align: center;">11.456</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of Wavelengths</td>
<td style="text-align: center;">696</td>
<td style="text-align: center;">110</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PLS Components</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Complexity Reduction (%)</td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">84.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Performance Change (%)</td>
<td style="text-align: center;">0%</td>
<td style="text-align: center;">+14.3%</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_rect(data = filter(combined_data, model == "Protein-Focused"), : All aesthetics have length 1, but the data has 106 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_rect(data = filter(combined_data, model == "Protein-Focused"), : All aesthetics have length 1, but the data has 106 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_rect(data = filter(combined_data, model == "Protein-Focused"), : All aesthetics have length 1, but the data has 106 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_rect(data = filter(combined_data, model == "Protein-Focused"), : All aesthetics have length 1, but the data has 106 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_rect(data = filter(combined_data, model == "Protein-Focused"), : All aesthetics have length 1, but the data has 106 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-model-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="nirs_revisions_files/figure-html/fig-model-comparison-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Comparison of regression coefficients: full spectrum vs protein-focused models
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="acknowledgments" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="acknowledgments"><span class="header-section-number">4</span> ACKNOWLEDGMENTS</h2>
<p>This work would not have been possible without the efforts of the field staff, undergraduate, and graduate students who planted, maintained, monitored and harvested these trials. Funding was provided by New York State through a grant from Empire State Development (AC477). We are grateful to those who provided seed for this project, including: Uniseeds, Verve Seeds, Winterfox Farms, International Hemp, Fiacre Seeds, and KonopiUS.</p>
</section>
<section id="conflict-of-interest" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="conflict-of-interest"><span class="header-section-number">5</span> CONFLICT OF INTEREST</h2>
<p>The authors declare no conflict of interest.</p>
</section>
<section id="references" class="level2" data-number="6">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">6 REFERENCES</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-barnes_standard_1989" class="csl-entry" role="listitem">
Barnes, R. J., Dhanoa, M. S., &amp; Lister, S. J. (1989). Standard normal variate transformation and de-trending of near-infrared diffuse reflectance spectra. <em>Applied Spectroscopy</em>, <em>43</em>(5), 772–777. <a href="https://doi.org/10.1366/0003702894202201">https://doi.org/10.1366/0003702894202201</a>
</div>
<div id="ref-datatable" class="csl-entry" role="listitem">
Barrett, T., Dowle, M., Srinivasan, A., Gorecki, J., Chirico, M., Hocking, T., Schwendinger, B., &amp; Krylov, I. (2025). <em><span class="nocase">data.table</span>: Extension of <span>“<span class="nocase">data.frame</span>”</span></em>. <a href="https://doi.org/10.32614/CRAN.package.data.table">https://doi.org/10.32614/CRAN.package.data.table</a>
</div>
<div id="ref-barta_proteomic_2024" class="csl-entry" role="listitem">
Bárta, J., Roudnický, P., Jarošová, M., Zdráhal, Z., Stupková, A., Bártová, V., Krejčová, Z., Kyselka, J., Filip, V., Říha, V., Lorenc, F., Bedrníček, J., &amp; Smetana, P. (2024). Proteomic profiles of whole seeds, hulls, and dehulled seeds of two industrial hemp (cannabis sativa l.) cultivars. <em>Plants</em>, <em>13</em>(1), 111. <a href="https://doi.org/10.3390/plants13010111">https://doi.org/10.3390/plants13010111</a>
</div>
<div id="ref-callaway_hempseed_2004" class="csl-entry" role="listitem">
Callaway, J. C. (2004). Hempseed as a nutritional resource: An overview. <em>Euphytica</em>, <em>140</em>(1), 65–72. <a href="https://doi.org/10.1007/s10681-004-4811-6">https://doi.org/10.1007/s10681-004-4811-6</a>
</div>
<div id="ref-chadalavada_nir_2022" class="csl-entry" role="listitem">
Chadalavada, K., Anbazhagan, K., Ndour, A., Choudhary, S., Palmer, W., Flynn, J. R., Mallayee, S., Pothu, S., Prasad, K. V. S. V., Varijakshapanikar, P., Jones, C. S., &amp; Kholová, J. (2022). <span>NIR</span> instruments and prediction methods for rapid access to grain protein content in multiple cereals. <em>Sensors (Basel, Switzerland)</em>, <em>22</em>(10). <a href="https://doi.org/10.3390/s22103710">https://doi.org/10.3390/s22103710</a>
</div>
<div id="ref-ely_industrial_2022" class="csl-entry" role="listitem">
Ely, K., &amp; Fike, J. (2022). Industrial hemp and hemp byproducts as sustainable feedstuffs in livestock diets. In D. C. Agrawal, R. Kumar, &amp; M. Dhanasekaran (Eds.), <em>Cannabis/hemp for sustainable agriculture and materials</em> (pp. 145–162). Springer. <a href="https://doi.org/10.1007/978-981-16-8778-5_6">https://doi.org/10.1007/978-981-16-8778-5_6</a>
</div>
<div id="ref-garrido-varo_note_2019" class="csl-entry" role="listitem">
Garrido-Varo, A., Garcia-Olmo, J., &amp; Fearn, T. (2019). A note on mahalanobis and related distance measures in <span>WinISI</span> and the unscrambler. <em>Journal of Near Infrared Spectroscopy</em>, <em>27</em>(4), 253–258. <a href="https://doi.org/10.1177/0967033519848296">https://doi.org/10.1177/0967033519848296</a>
</div>
<div id="ref-geyer_genetics_2022" class="csl-entry" role="listitem">
Geyer, M., Mohler, V., &amp; Hartl, L. (2022). Genetics of the inverse relationship between grain yield and grain protein content in common wheat. <em>Plants</em>, <em>11</em>(16), 2146. <a href="https://doi.org/10.3390/plants11162146">https://doi.org/10.3390/plants11162146</a>
</div>
<div id="ref-giancaspro_genetic_2019" class="csl-entry" role="listitem">
Giancaspro, A., Giove, S. L., Blanco, A., &amp; Gadaleta, A. (2019). Genetic variation for protein content and yield-related traits in a durum population derived from an inter-specific cross between hexaploid and tetraploid wheat cultivars. <em>Frontiers in Plant Science</em>, <em>10</em>. <a href="https://doi.org/10.3389/fpls.2019.01509">https://doi.org/10.3389/fpls.2019.01509</a>
</div>
<div id="ref-hayes_measuring_2020" class="csl-entry" role="listitem">
Hayes, M. (2020). Measuring protein content in food: An overview of methods. <em>Foods</em>, <em>9</em>(10), 1340. <a href="https://doi.org/10.3390/foods9101340">https://doi.org/10.3390/foods9101340</a>
</div>
<div id="ref-tidymodels" class="csl-entry" role="listitem">
Kuhn, M., &amp; Wickham, H. (2020). <em><span>Tidymodels</span>: A collection of packages for modeling and machine learning using tidyverse principles.</em> <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>
</div>
<div id="ref-caret" class="csl-entry" role="listitem">
Kuhn, &amp; Max. (2008). Building predictive models in r using the caret package. <em>Journal of Statistical Software</em>, <em>28</em>(5), 1–26. <a href="https://doi.org/10.18637/jss.v028.i05">https://doi.org/10.18637/jss.v028.i05</a>
</div>
<div id="ref-emmeans" class="csl-entry" role="listitem">
Lenth, R. V. (2025). <em><span class="nocase">emmeans</span>: Estimated marginal means, aka least-squares means</em>. <a href="https://doi.org/10.32614/CRAN.package.emmeans">https://doi.org/10.32614/CRAN.package.emmeans</a>
</div>
<div id="ref-li_quantitative_2020" class="csl-entry" role="listitem">
Li, Y., Huang, Y., Xia, J., Xiong, Y., &amp; Min, S. (2020). Quantitative analysis of honey adulteration by spectrum analysis combined with several high-level data fusion strategies. <em>Vibrational Spectroscopy</em>, <em>108</em>, 103060. <a href="https://doi.org/10.1016/j.vibspec.2020.103060">https://doi.org/10.1016/j.vibspec.2020.103060</a>
</div>
<div id="ref-pls" class="csl-entry" role="listitem">
Liland, K. H., Mevik, B.-H., &amp; Wehrens, R. (2024). <em><span class="nocase">pls</span>: Partial least squares and principal component regression</em>. <a href="https://doi.org/10.32614/CRAN.package.pls">https://doi.org/10.32614/CRAN.package.pls</a>
</div>
<div id="ref-luce_prediction_2017" class="csl-entry" role="listitem">
Luce, M. S., Ziadi, N., Gagnon, B., &amp; Lévesque, V. (2017). Prediction of total carbon, total nitrogen, and <span class="nocase">pH</span> of organic materials using visible near-infrared reflectance spectroscopy. <em>Canadian Journal of Soil Science</em>, <em>98</em>(1), 175–179. <a href="https://doi.org/10.1139/cjss-2017-0109">https://doi.org/10.1139/cjss-2017-0109</a>
</div>
<div id="ref-luo_properties_2005" class="csl-entry" role="listitem">
Luo, J., Ying, K., He, P., &amp; Bai, J. (2005). Properties of savitzky–golay digital differentiators. <em>Digital Signal Processing</em>, <em>15</em>(2), 122–136. <a href="https://doi.org/10.1016/j.dsp.2004.09.008">https://doi.org/10.1016/j.dsp.2004.09.008</a>
</div>
<div id="ref-nlme2000" class="csl-entry" role="listitem">
Pinheiro, J. C., &amp; Bates, D. M. (2000). <em>Mixed-effects models in s and s-PLUS</em>. Springer. <a href="https://doi.org/10.1007/b98882">https://doi.org/10.1007/b98882</a>
</div>
<div id="ref-nlme2025" class="csl-entry" role="listitem">
Pinheiro, J., Bates, D., &amp; R Core Team. (2025). <em><span class="nocase">nlme</span>: Linear and nonlinear mixed effects models</em>. <a href="https://doi.org/10.32614/CRAN.package.nlme">https://doi.org/10.32614/CRAN.package.nlme</a>
</div>
<div id="ref-base" class="csl-entry" role="listitem">
R Core Team. (2025). <em><span>R</span>: A language and environment for statistical computing</em>. R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>
</div>
<div id="ref-rawal_visible_2024" class="csl-entry" role="listitem">
Rawal, A., Hartemink, A., Zhang, Y., Wang, Y., Lankau, R. A., &amp; Ruark, M. D. (2024). Visible and near-infrared spectroscopy predicted leaf nitrogen contents of potato varieties under different growth and management conditions. <em>Precision Agriculture</em>, <em>25</em>(2), 751–770. <a href="https://doi.org/10.1007/s11119-023-10091-z">https://doi.org/10.1007/s11119-023-10091-z</a>
</div>
<div id="ref-reeves_potential_2012" class="csl-entry" role="listitem">
Reeves, J. B. (2012). Potential of near- and mid-infrared spectroscopy in biofuel production. <em>Communications in Soil Science and Plant Analysis</em>, <em>43</em>(1), 478–495. <a href="https://doi.org/10.1080/00103624.2012.641844">https://doi.org/10.1080/00103624.2012.641844</a>
</div>
<div id="ref-rinnan_review_2009" class="csl-entry" role="listitem">
Rinnan, Å., Berg, F. van den, &amp; Engelsen, S. B. (2009). Review of the most common pre-processing techniques for near-infrared spectra. <em><span>TrAC</span> Trends in Analytical Chemistry</em>, <em>28</em>(10), 1201–1222. <a href="https://doi.org/10.1016/j.trac.2009.07.007">https://doi.org/10.1016/j.trac.2009.07.007</a>
</div>
<div id="ref-roberts_near-infrared_2004" class="csl-entry" role="listitem">
Roberts, C. A., Workman, J., &amp; Reeves, J. B. (2004). <em>Near-infrared spectroscopy in agriculture</em>. American Society of Agronomy.
</div>
<div id="ref-prospectr" class="csl-entry" role="listitem">
Stevens, A., &amp; Ramirez-Lopez, L. (2025). <em>An introduction to the prospectr package</em>.
</div>
<div id="ref-skimr" class="csl-entry" role="listitem">
Waring, E., Quinn, M., McNamara, A., Arino de la Rubia, E., Zhu, H., &amp; Ellis, S. (2022). <em><span class="nocase">skimr</span>: Compact and flexible summaries of data</em>. <a href="https://doi.org/10.32614/CRAN.package.skimr">https://doi.org/10.32614/CRAN.package.skimr</a>
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, H., Averick, M., Bryan, J., Chang, W., McGowan, L. D., François, R., Grolemund, G., Hayes, A., Henry, L., Hester, J., Kuhn, M., Pedersen, T. L., Miller, E., Bache, S. M., Müller, K., Ooms, J., Robinson, D., Seidel, D. P., Spinu, V., … Yutani, H. (2019). Welcome to the <span class="nocase">tidyverse</span>. <em>Journal of Open Source Software</em>, <em>4</em>(43), 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>
</div>
<div id="ref-williams_application_1975" class="csl-entry" role="listitem">
Williams, P. C. (1975). Application of near infrared reflectance spectroscopy to analysis of cereal grains and oilseeds. <em>Cereal Chemistry</em>, <em>52</em>(4), 576–561.
</div>
<div id="ref-wold_pls-regression_2001" class="csl-entry" role="listitem">
Wold, S., Sjöström, M., &amp; Eriksson, L. (2001). <span>PLS</span>-regression: A basic tool of chemometrics. <em>Chemometrics and Intelligent Laboratory Systems</em>, <em>58</em>(2), 109–130. <a href="https://doi.org/10.1016/S0169-7439(01)00155-1">https://doi.org/10.1016/S0169-7439(01)00155-1</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
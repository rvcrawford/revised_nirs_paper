{
  "hash": "6772b4f72d4a2c99227e3674d5103d16",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Near Infrared Spectroscopy Predicts Crude Protein Concentration in Hemp Grain\nexecute:\n  freeze: auto\n  echo: false\nauthor:\n  - name: Ryan V. Crawford\n    orcid: 0009-0006-3052-3269\n    corresponding: true\n    email: rvc3@cornell.edu\n    affiliations:\n      - name: Cornell University\n        address: 126 Medicago Drive\n        city: Ithaca\n        state: NY\n        postal-code: 14853\n  - name: Jamie L. Crawford\n    orcid: 0009-0002-2523-3479\n    corresponding: false\n    affiliations:\n      - name: Cornell University\n        address: 126 Medicago Drive\n        city: Ithaca\n        state: NY\n        postal-code: 14853\n  - name: Julie L. Hansen\n    orcid: 0000-0001-7247-9186\n    corresponding: false\n    affiliations:\n      - name: Cornell University\n        address: 126 Medicago Drive\n        city: Ithaca\n        state: NY\n        postal-code: 14853\n  - name: Lawrence B. Smart\n    orcid: 0000-0002-7812-7736\n    corresponding: false\n    affiliations:\n      - name: Cornell AgriTech\n        address: 102 Hedrick Hall\n        city: Geneva\n        state: NY\n        postal-code: 14456\n  - name: Virginia M. Moore\n    orcid: 0000-0001-7888-3366\n    corresponding: false\n    affiliations:\n      - name: Cornell University\n        address: 162 Emerson Hall\n        city: Ithaca\n        state: NY\n        postal-code: 14853    \ntitle-block-style: none\nkeywords:\n  - Hemp\n  - Grain\n  - Spectroscopy\nabstract: |\n      The protein concentration of hemp (*Cannabis sativa* L.) grain is of interest to researchers, producers, and consumers. This study was conducted to determine whether hemp grain can be non-destructively assayed for crude protein (CP) concentration using spectra obtained from near-infrared spectroscopy (NIRS) to build a prediction model for crude protein concentration using partial least squares regression (PLSR). One hundred and fourty-nine whole hemp grain samples were obtained from 18 cultivar trials in New York (NY) from 2017-2021. The samples' NIRS spectra were collected and the samples were ground and assayed by combustion. Seven potential preprocessing methods, as well as untransformed spectra, were tested using 100 training and testing set splits of the data and the best method was selected. That method was applied to 1000 additional splits of the data set. Model fit was evaluated using RMSE, R^2^, relative predicted deviation (RPD), and ratio of performance to interquartile distance (RPIQ). Once a preprocessing method was selected, the optimal number of model components and prediction performance on the testing sets were examined. A preprocessing method consisting of the standard normal variate transformation following a Savitzky-Golay filter had the lowest RMSE and the highest R^2^, RPD and RPIQ, with RPD and RPIQ 2.1%, and 2.4% higher than a Savitzky-Golay filter by itself (significant at $\\alpha$ \\<0.05). All preprocessing methods outperformed untransformed spectra. Optimal final models typically consisted of 12 components. Seventy-four percent of the 1000 final models had, at minimum, the ability to distinguish between high and low values of CP concentration, with 49% of the models capable of approximating quantitative prodiction. The models tested to overestimate CP concentration by 0.5% in the lowest tertile of samples and underestimate CP concentration by 0.4% in the highest tertile of samples. The worst-predicted samples tended to come from Geneva, NY, possibly as a result of the models' class imbalance (half of the samples were from Ithaca, NY while 28% were from Geneva). The research shows the promise that NIRS offers in the non-desctructive assay of CP concentration in hemp grain.\n\nplain-language-summary: |\n  A model was developed to predict percent crude protein in hemp grain using near infrared spectroscopy.\nkey-points:\n  - Models were developed to predict crude protein concentration in hemp grain using near infrared spectroscopy.\n  - Most models were able to distinguish between high and lower concentrations of crude protein. \n  - Models could be further optimized by including more samples and rectifying class imbalances between environments.\ndate: last-modified\nbibliography: \n  - references.bib\n  - grateful-refs.bib\ncsl: apa.csl\nnumber-sections: true\ncrossref:\n  custom:\n    - kind: float\n      key: suppfig\n      latex-env: suppfig\n      reference-prefix: Figure S\n      space-before-numbering: false\n      latex-list-of-description: Supplementary Figure\n---\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple check:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- Hemp data: 149 samples \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- Best method: Savitzky-Golay smoothing \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- Final analysis: Available \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- Preprocessing analysis: Available \n```\n\n\n:::\n:::\n\n\nCP, crude protein; NIR, near-infrared; NIRS, Near-infrared spectroscopy; NY, New York; PLSR, partial least squares regression; RPD, relative predicted deviation, RPIQ, ratio of performance to interquartile distance; SG, Savitzky-Golay; SNV, standard normal variate, SNV-SG, standard normal variate following Savitzky-Golay\n\n## INTRODUCTION\n\nHemp (*Cannabis sativa* L.) is an annual crop with potential uses as a source of food or feed, derived from the grain, and fiber (bast or hurd), derived from the stalk. Hemp cultivars are commonly grown for one or both purposes and a cultivar may be called a grain, fiber, or dual-purpose type. Because of its nutritional importance, the protein concentration of a grain crop is a prime consideration for researchers, producers, and consumers. Whole hemp grain typically contains approximately 200-300 g kg^‚àí1^ protein [@ely_industrial_2022; @barta_proteomic_2024; @callaway_hempseed_2004; @liu2023]. Crude protein is often used as a proxy for the direct measurement of protein concentration and consists of the multiplication of nitrogen concentration by a conversion factor, often 6.25 [@hayes_measuring_2020].\n\nNear-infrared (NIR) spectroscopy (NIRS) technology is rapid, non-destructive, and inexpensive. It consists of the measurement of NIR radiation reflected and absorbed from a sample (the spectra) and the relation of the spectra to primary analytical values, typically obtained using wet chemistry assays, for components such as moisture, protein, fat, or fiber [@roberts_near-infrared_2004]. NIRS technology has been used since the 1970's to assess forage CP concentration [@reeves_potential_2012; @williams_application_1975]. A NIRS calibration set often consists of samples from diverse genotypes of one species grown in many environments encompassing the range of expected values from the analyte or analytes [@chadalavada_nir_2022]. Partial least squares regression (PLSR) is a typical method used in the agricultural and food sciences to relate spectra to analyte [@roberts_near-infrared_2004]. Partial least squares regression calculates components that maximize covariance between predictor and response variables. Partial least squares regression uses some number of components, often selected via cross-validation, to fit the regression model and is commonly used in spectroscopy because it tends to work well with highly correlated, noisy spectral data [@wold_pls-regression_2001].\n\nA NIRS-scanned sample of whole grain may be used for other purposes besides the scan, including planting as a seed. In wheat and corn, grain protein content has been shown to be heritable [@giancaspro_genetic_2019; @geyer_genetics_2022]. This suggests that NIRS technology could serve as a resource to rapidly identify high concentration CP hemp germplasm, enabling the screening of germplasm as seed, before planting to the field, and facilitating the efficient development of high concentration CP hemp populations.\n\nFor this study, a benchtop NIR spectrometer was used to develop a model to predict CP concentration based on a data set of hemp grain representing multiple years, locations, and cultivars from grain and dual-purpose hemp types using PLSR.\n\n# Hemp NIR Analysis - Streamlined Pipeline Results\n\n## Data Overview\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n**Dataset Summary:**\n- Total samples: ** 149 **\n- Protein range:  208  -  308  g/kg\n- Protein mean:  261  g/kg\n- Locations:  11  ( Cnoll, Rnooa, Mg4e , ... )\n- Study period:  2017 - 2022 \n- Spectral variables:  700  wavelengths\n```\n\n\n:::\n:::\n\n\n## Preprocessing Method Selection\n\n**Optimal method identified:** **Savitzky-Golay smoothing**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n### Preprocessing Comparison Summary\n\n- **Methods tested:**  8 \n```\n\n\n:::\n:::\n\n\n## Model Performance\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n### Final Model Performance\n\n**Performance Metrics (mean ¬± SD):**\n\n| Metric | Value | Interpretation |\n|--------|-------|----------------|\n| RMSE |  13.97  ¬±  6.03  g/kg | Root Mean Square Error |\n| R¬≤ |  0.729  ¬±  0.198  |  72.9 % variance explained |\n| RPD |  2.04  ¬±  0.73  |  Good  for quantitative use |\n\n**Model Quality Distribution:**\n- Excellent models (RPD > 2.5):  1 \n- Good models (RPD 2.0-2.5):  1 \n- Approximate models (RPD 1.5-2.0):  0 \n```\n\n\n:::\n:::\n\n\n## Data Tables\n\n### Sample Summary\n\n\n::: {#tbl-sample-summary .cell tbl-cap='Hemp grain sample summary'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Sample characteristics by location</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Location </th>\n   <th style=\"text-align:right;\"> Samples </th>\n   <th style=\"text-align:right;\"> Mean CP (g/kg) </th>\n   <th style=\"text-align:right;\"> SD CP (g/kg) </th>\n   <th style=\"text-align:right;\"> Min CP (g/kg) </th>\n   <th style=\"text-align:right;\"> Max CP (g/kg) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Cnoll </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 265.2 </td>\n   <td style=\"text-align:right;\"> 21.5 </td>\n   <td style=\"text-align:right;\"> 236 </td>\n   <td style=\"text-align:right;\"> 301 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rnooa </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 265.4 </td>\n   <td style=\"text-align:right;\"> 18.1 </td>\n   <td style=\"text-align:right;\"> 231 </td>\n   <td style=\"text-align:right;\"> 291 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mg4e </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 263.7 </td>\n   <td style=\"text-align:right;\"> 5.5 </td>\n   <td style=\"text-align:right;\"> 254 </td>\n   <td style=\"text-align:right;\"> 274 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mg4l </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 231.6 </td>\n   <td style=\"text-align:right;\"> 22.0 </td>\n   <td style=\"text-align:right;\"> 208 </td>\n   <td style=\"text-align:right;\"> 286 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ithaca </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 261.1 </td>\n   <td style=\"text-align:right;\"> 23.7 </td>\n   <td style=\"text-align:right;\"> 224 </td>\n   <td style=\"text-align:right;\"> 304 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Freeville </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 266.2 </td>\n   <td style=\"text-align:right;\"> 25.4 </td>\n   <td style=\"text-align:right;\"> 217 </td>\n   <td style=\"text-align:right;\"> 296 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Chazy </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 248.8 </td>\n   <td style=\"text-align:right;\"> 39.0 </td>\n   <td style=\"text-align:right;\"> 216 </td>\n   <td style=\"text-align:right;\"> 296 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cn North </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 226.7 </td>\n   <td style=\"text-align:right;\"> 9.3 </td>\n   <td style=\"text-align:right;\"> 216 </td>\n   <td style=\"text-align:right;\"> 233 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mcg </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 259.8 </td>\n   <td style=\"text-align:right;\"> 21.0 </td>\n   <td style=\"text-align:right;\"> 227 </td>\n   <td style=\"text-align:right;\"> 283 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Geneva </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 280.8 </td>\n   <td style=\"text-align:right;\"> 18.1 </td>\n   <td style=\"text-align:right;\"> 237 </td>\n   <td style=\"text-align:right;\"> 308 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Willsboro </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 276.7 </td>\n   <td style=\"text-align:right;\"> 23.0 </td>\n   <td style=\"text-align:right;\"> 257 </td>\n   <td style=\"text-align:right;\"> 302 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:right;\"> 149 </td>\n   <td style=\"text-align:right;\"> 261.0 </td>\n   <td style=\"text-align:right;\"> 24.6 </td>\n   <td style=\"text-align:right;\"> 208 </td>\n   <td style=\"text-align:right;\"> 308 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Preprocessing Method Comparison\n\n\n::: {#tbl-preprocessing .cell tbl-cap='Comparison of spectral preprocessing methods'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Preprocessing method comparison (mean ¬± SD)</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Method </th>\n   <th style=\"text-align:left;\"> RMSE (g/kg) </th>\n   <th style=\"text-align:left;\"> R¬≤ </th>\n   <th style=\"text-align:left;\"> RPD </th>\n   <th style=\"text-align:left;\"> RPIQ </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Raw spectra </td>\n   <td style=\"text-align:left;\"> 11.8 ¬± 0.7 </td>\n   <td style=\"text-align:left;\"> 0.778 ¬± 0.042 </td>\n   <td style=\"text-align:left;\"> 2.1 ¬± 0.26 </td>\n   <td style=\"text-align:left;\"> 3.37 ¬± 0.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> First derivative </td>\n   <td style=\"text-align:left;\"> 11.1 ¬± 2.1 </td>\n   <td style=\"text-align:left;\"> 0.794 ¬± 0.081 </td>\n   <td style=\"text-align:left;\"> 2.27 ¬± 0.41 </td>\n   <td style=\"text-align:left;\"> 3.68 ¬± 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Savitzky-Golay smoothing </td>\n   <td style=\"text-align:left;\"> 10.6 ¬± 1.6 </td>\n   <td style=\"text-align:left;\"> 0.818 ¬± 0.055 </td>\n   <td style=\"text-align:left;\"> 2.37 ¬± 0.43 </td>\n   <td style=\"text-align:left;\"> 3.83 ¬± 0.58 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Gap-segment derivative </td>\n   <td style=\"text-align:left;\"> 11.2 ¬± 2.5 </td>\n   <td style=\"text-align:left;\"> 0.782 ¬± 0.097 </td>\n   <td style=\"text-align:left;\"> 2.29 ¬± 0.66 </td>\n   <td style=\"text-align:left;\"> 3.67 ¬± 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Standard normal variate (SNV) </td>\n   <td style=\"text-align:left;\"> 11.7 ¬± 3.1 </td>\n   <td style=\"text-align:left;\"> 0.77 ¬± 0.12 </td>\n   <td style=\"text-align:left;\"> 2.25 ¬± 0.81 </td>\n   <td style=\"text-align:left;\"> 3.58 ¬± 1.02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SNV + Savitzky-Golay </td>\n   <td style=\"text-align:left;\"> 10.7 ¬± 1.8 </td>\n   <td style=\"text-align:left;\"> 0.808 ¬± 0.069 </td>\n   <td style=\"text-align:left;\"> 2.35 ¬± 0.48 </td>\n   <td style=\"text-align:left;\"> 3.78 ¬± 0.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SNV + detrending </td>\n   <td style=\"text-align:left;\"> 11.9 ¬± 3.2 </td>\n   <td style=\"text-align:left;\"> 0.751 ¬± 0.128 </td>\n   <td style=\"text-align:left;\"> 2.22 ¬± 0.84 </td>\n   <td style=\"text-align:left;\"> 3.53 ¬± 1.08 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Multiplicative scatter correction </td>\n   <td style=\"text-align:left;\"> 11.9 ¬± 3.6 </td>\n   <td style=\"text-align:left;\"> 0.752 ¬± 0.138 </td>\n   <td style=\"text-align:left;\"> 2.27 ¬± 0.96 </td>\n   <td style=\"text-align:left;\"> 3.6 ¬± 1.26 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Visualizations\n\n### Model Calibration\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Model calibration showing component optimization](hemp_nir_paper_files/figure-html/fig-calibration-1.png){#fig-calibration width=672}\n:::\n:::\n\n\n### Performance Distribution\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of model performance metrics across iterations](hemp_nir_paper_files/figure-html/fig-performance-1.png){#fig-performance width=672}\n:::\n:::\n\n\n### Validation Analysis\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Validation error analysis across protein concentration range](hemp_nir_paper_files/figure-html/fig-validation-1.png){#fig-validation width=672}\n:::\n:::\n\n\n## Summary and Conclusions\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n### Research Outcomes\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚úÖ **Analysis Complete:** All pipeline components successfully executed\n\nüéØ **Optimal preprocessing identified:**  Savitzky-Golay smoothing  provides best prediction performance\n\nüìà **Prediction quality:** RPD =  2.04  indicates  good to excellent  prediction capability\n\nüî¨ **NIR spectroscopy demonstrates strong potential** for non-destructive hemp grain protein assessment\n\n‚öôÔ∏è **Preprocessing optimization proves critical** for achieving reliable predictions\n\nüîÑ **Reproducible pipeline ensures** transparent and reliable research workflow\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n### Technical Implementation\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- **Framework:** R targets pipeline for reproducible research\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- **Model type:** Partial Least Squares Regression (PLSR)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- **Validation:** Cross-validation with multiple preprocessing approaches\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- **Iterations:** Multiple modeling iterations for robust performance assessment\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n- **Sample size:**  149  hemp grain samples\n- **Spectral range:**  1100 - 2500  nm ( 700  variables)\n```\n\n\n:::\n:::\n\n\n---\n\n**Pipeline Status:** ‚úÖ Complete  \n**Generated:** 2025-06-25 15:30:20  \n**Framework:** Targets-based reproducible workflow",
    "supporting": [
      "hemp_nir_paper_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}